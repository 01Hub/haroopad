!function(e){"use strict";function t(e){return function(t){return this===t.target?e.apply(this,arguments):void 0}}var i=function(e,t){this.init(e,t)};i.prototype={constructor:i,init:function(t,i){if(this.$element=e(t),this.options=e.extend({},e.fn.modalmanager.defaults,this.$element.data(),"object"==typeof i&&i),this.stack=[],this.backdropCount=0,this.options.resize){var n,r=this;e(window).on("resize.modal",function(){n&&clearTimeout(n),n=setTimeout(function(){for(var e=0;r.stack.length>e;e++)r.stack[e].isShown&&r.stack[e].layout()},10)})}},createModal:function(t,i){e(t).modal(e.extend({manager:this},i))},appendModal:function(i){this.stack.push(i);var n=this;i.$element.on("show.modalmanager",t(function(){var t=function(){i.isShown=!0;var t=e.support.transition&&i.$element.hasClass("fade");n.$element.toggleClass("modal-open",n.hasOpenModal()).toggleClass("page-overflow",e(window).height()<n.$element.height()),i.$parent=i.$element.parent(),i.$container=n.createContainer(i),i.$element.appendTo(i.$container),n.backdrop(i,function(){i.$element.show(),t&&i.$element[0].offsetWidth,i.layout(),i.$element.addClass("in").attr("aria-hidden",!1);var r=function(){n.setFocus(),i.$element.triggerHandler("shown")};t?i.$element.one(e.support.transition.end,r):r()})};i.options.replace?n.replace(t):t()})),i.$element.on("hidden.modalmanager",t(function(){n.backdrop(i),i.$backdrop?e.support.transition&&i.$element.hasClass("fade")?i.$backdrop.one(e.support.transition.end,function(){n.destroyModal(i)}):n.destroyModal(i):n.destroyModal(i)})),i.$element.on("destroy.modalmanager",t(function(){n.removeModal(i)}))},destroyModal:function(e){e.destroy();var t=this.hasOpenModal();this.$element.toggleClass("modal-open",t),t||this.$element.removeClass("page-overflow"),this.removeContainer(e),this.setFocus()},hasOpenModal:function(){for(var e=0;this.stack.length>e;e++)if(this.stack[e].isShown)return!0;return!1},setFocus:function(){for(var e,t=0;this.stack.length>t;t++)this.stack[t].isShown&&(e=this.stack[t]);e&&e.focus()},removeModal:function(e){e.$element.off(".modalmanager"),e.$backdrop&&this.removeBackdrop.call(e),this.stack.splice(this.getIndexOfModal(e),1)},getModalAt:function(e){return this.stack[e]},getIndexOfModal:function(e){for(var t=0;this.stack.length>t;t++)if(e===this.stack[t])return t},replace:function(i){for(var n,r=0;this.stack.length>r;r++)this.stack[r].isShown&&(n=this.stack[r]);n?(this.$backdropHandle=n.$backdrop,n.$backdrop=null,i&&n.$element.one("hidden",t(e.proxy(i,this))),n.hide()):i&&i()},removeBackdrop:function(e){e.$backdrop.remove(),e.$backdrop=null},createBackdrop:function(t){var i;return this.$backdropHandle?(i=this.$backdropHandle,i.off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):i=e('<div class="modal-backdrop '+t+'" />').appendTo(this.$element),i},removeContainer:function(e){e.$container.remove(),e.$container=null},createContainer:function(i){var r;return r=e('<div class="modal-scrollable">').css("z-index",n("modal",i?this.getIndexOfModal(i):this.stack.length)).appendTo(this.$element),i&&"static"!=i.options.backdrop?r.on("click.modal",t(function(){i.hide()})):i&&r.on("click.modal",t(function(){i.attention()})),r},backdrop:function(t,i){var r=t.$element.hasClass("fade")?"fade":"",o=t.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(t.isShown&&o){var a=e.support.transition&&r&&!this.$backdropHandle;t.$backdrop=this.createBackdrop(r),t.$backdrop.css("z-index",n("backdrop",this.getIndexOfModal(t))),a&&t.$backdrop[0].offsetWidth,t.$backdrop.addClass("in"),this.backdropCount+=1,a?t.$backdrop.one(e.support.transition.end,i):i()}else if(!t.isShown&&t.$backdrop){t.$backdrop.removeClass("in"),this.backdropCount-=1;var s=this;e.support.transition&&t.$element.hasClass("fade")?t.$backdrop.one(e.support.transition.end,function(){s.removeBackdrop(t)}):s.removeBackdrop(t)}else i&&i()},removeSpinner:function(){this.$spinner&&this.$spinner.remove(),this.$spinner=null,this.isLoading=!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove(),this.$backdropHandle=null,this.removeSpinner()},loading:function(t){if(t=t||function(){},this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",e(window).height()<this.$element.height()),this.isLoading)if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var i=this;e.support.transition?this.$backdropHandle.one(e.support.transition.end,function(){i.removeLoading()}):i.removeLoading()}else t&&t(this.isLoading);else{this.$backdropHandle=this.createBackdrop("fade"),this.$backdropHandle[0].offsetWidth,this.$backdropHandle.css("z-index",n("backdrop",this.stack.length)).addClass("in");var r=e(this.options.spinner).css("z-index",n("modal",this.stack.length)).appendTo(this.$element).addClass("in");this.$spinner=e(this.createContainer()).append(r).on("click.modalmanager",e.proxy(this.loading,this)),this.isLoading=!0,e.support.transition?this.$backdropHandle.one(e.support.transition.end,t):t()}}};var n=function(){var t,i={};return function(n,r){if(t===void 0){var o=e('<div class="modal hide" />').appendTo("body"),a=e('<div class="modal-backdrop hide" />').appendTo("body");i.modal=+o.css("z-index"),i.backdrop=+a.css("z-index"),t=i.modal-i.backdrop,o.remove(),a.remove(),a=o=null}return i[n]+t*r}}();e.fn.modalmanager=function(t,n){return this.each(function(){var r=e(this),o=r.data("modalmanager");o||r.data("modalmanager",o=new i(this,t)),"string"==typeof t&&o[t].apply(o,[].concat(n))})},e.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>'},e.fn.modalmanager.Constructor=i}(jQuery);