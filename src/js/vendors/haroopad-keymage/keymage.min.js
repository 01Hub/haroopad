!function(a,b){a(function(){function a(a){var b=a.split("-"),c=b[b.length-1],d={code:p[c]};if(!d.code)throw'Unknown key "'+c+'" in keystring "'+a+'"';for(var e,f=0;f<b.length-1;f++){if(c=b[f],e=m[c],!e)throw'Unknown modifier "'+c+'" in keystring "'+a+'"';d[e]=!0}return d}function c(a){for(var b="",c=0;c<n.length;c++)a[n[c]]&&(b+=n[c]+"-");return b+=q[a.code]}function d(b){for(var d=[],e=b.split(" "),f=0;f<e.length;f++){var g=a(e[f]);g=c(g),d.push(g)}return d.original=b,d}function e(a){for(var b={code:a.keyCode},d=0;d<l.length;d++){var e=l[d];a[e]&&(b[e.slice(0,e.length-3)]=!0)}return c(b)}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d&&(a=a[d]),!a)break}return a}function g(a){if(!~o.indexOf(a.keyCode)&&!a.altGraphKey){var b=v.slice();b.push(e(a));for(var c,d,g,h=t.split("."),i=h.length;i>=0;i--)if(d=f(u,h.slice(0,i))){c=!0;for(var j=0;j<b.length;j++){if(g=b[j],!d[g]){c=!1;break}d=d[g]}if(c)break}var k=h.slice(0,i).join("."),l=d.preventDefault;if(c&&!d.handlers)return v=b,void(l&&a.preventDefault());if(c)for(i=0;i<d.handlers.length;i++){var m=d.handlers[i],n=m._keymage,p=m.call(n.context,a,{shortcut:n.original,scope:t,definitionScope:k});(p===!1||l)&&a.preventDefault()}v=[]}}function h(a,b,c){var d=a.split("."),e=u;d=d.concat(b);for(var f=0,g=d.length;g>f;f++){var h=d[f];if(h&&(e=e[h]||(e[h]={}),c._keymage.preventDefault&&(e.preventDefault=!0),f===g-1)){var i=e.handlers||(e.handlers=[]);i.push(c)}}}function i(a,c,e,f){if(c===b&&e===b)return function(b,c){return i(a,b,c)};"function"==typeof c&&(f=e,e=c,c=a,a="");var g=d(c);e._keymage=f||{},e._keymage.original=c,h(a,g,e)}var j,k="1.0.1",l=["shiftKey","ctrlKey","altKey","metaKey"],m={shift:"shift",ctrl:"ctrl",control:"ctrl",alt:"alt",option:"alt",win:"meta",cmd:"meta","super":"meta",meta:"meta",defmod:~navigator.userAgent.indexOf("Mac OS X")?"meta":"ctrl"},n=["shift","ctrl","alt","meta"],o=[16,17,18,91],p={backspace:8,tab:9,enter:13,"return":13,pause:19,caps:20,capslock:20,escape:27,esc:27,space:32,pgup:33,pageup:33,pgdown:34,pagedown:34,end:35,home:36,ins:45,insert:45,del:46,"delete":46,left:37,up:38,right:39,down:40,"*":106,"+":107,plus:107,"-":109,minus:109,";":186,"=":187,",":188,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(j=0;10>j;j++)p["num-"+j]=j+95;for(j=0;10>j;j++)p[j.toString()]=j+48;for(j=1;25>j;j++)p["f"+j]=j+111;for(j=65;91>j;j++)p[String.fromCharCode(j).toLowerCase()]=j;var q={};for(var r in p){var s=p[r];(!q[s]||q[s].length<r.length)&&(q[s]=r)}var t="",u={},v=[];return i.parse=a,i.stringify=c,i.bindings=u,i.setScope=function(a){t=a?a:""},i.getScope=function(){return t},i.pushScope=function(a){return t=(t?t+".":"")+a},i.popScope=function(a){var b;return a?(t=t.replace(new RegExp("(^|\\.)"+a+"(\\.|$).*"),""),a):(b=t.lastIndexOf("."),a=t.slice(b+1),t=-1==b?"":t.slice(0,b),a)},i.version=k,window.addEventListener("keydown",g,!1),i})}("undefined"!=typeof define?define:function(a){window.keymage=a()});